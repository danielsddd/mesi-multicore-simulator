================================================================================
MULTI-CORE SIMULATOR TECHNICAL SPECIFICATIONS - COURSE 0512.4461
================================================================================

1. SYSTEM ARCHITECTURE
--------------------------------------
* Structure: 4 symmetric cores connected via a shared BUS to Main Memory[cite: 3, 17].
* Main Memory: 2^21 words, word-addressable only (no byte access)[cite: 46, 47].
* Latency: 16 cycles for the first word of a block, then 1 word per cycle[cite: 55].

2. CORE & PIPELINE RULES
---------------------------------------------------
* Pipeline Stages: 5 stages (Fetch, Decode, Execute, Mem, Write Back)[cite: 28, 29].
* Delay Slot: The instruction following a branch/jump always executes[cite: 28].
* Register File:
    - 16 Registers, 32-bit width[cite: 20].
    - R0: Identity zero; writes are ignored[cite: 22, 23].
    - R1: Hardwired to the current instruction's sign-extended immediate[cite: 21].
    - R1 updates every cycle during the Decode stage[cite: 21, 22].
    - Access: 1 full cycle (3 reads + 1 write simultaneously). Data written in cycle N is visible in N+1[cite: 32].
* Branch Resolution: Performed in the Decode stage[cite: 33].
* Hazards: Handled by stalling the dependent instruction in the Decode stage[cite: 35, 36]. No forwarding is used[cite: 30].

3. CACHE HIERARCHY (PER CORE)
--------------------------------------
* Type: Direct-mapped data cache[cite: 38, 39].
* Size: 512 words total[cite: 39].
* Block Size: 8 words[cite: 40].
* Policy: Write-back, Write-allocate[cite: 40].
* Components:
    - DSRAM: 512 words x 32-bit (Stores data)[cite: 41].
    - TSRAM: 64 rows (Stores 12-bit Tag and 2-bit MESI state)[cite: 42, 43].
* Cache Miss: Stalls the instruction in the Mem stage[cite: 37].

4. BUS & MESI PROTOCOL
------------------------------------------------
* Protocol: MESI (0: Invalid, 1: Shared, 2: Exclusive, 3: Modified)[cite: 43].
* Bus Signals:
    - bus_origid (3 bits): 0-3 for Cores, 4 for Main Memory[cite: 48].
    - bus_cmd (2 bits): 0: NoCmd, 1: BusRd, 2: BusRdX, 3: Flush[cite: 48].
    - bus_addr (21 bits): Word address[cite: 48].
    - bus_data (32 bits): Word data[cite: 48].
    - bus_shared (1 bit): Set to 1 during BusRd if another core has the data[cite: 48, 58].
* Arbitration: Round-Robin (last granted user becomes lowest priority)[cite: 49].
* Transaction: One transaction per cycle[cite: 49]. Bus is locked until BusRd/BusRdX is completed by a Flush[cite: 50].
* Snooping:
    - If a core has data in 'Modified' and sees BusRd/BusRdX, it must provide the block via Flush[cite: 59].
    - In this case, Main Memory is updated simultaneously[cite: 59].

5. INSTRUCTION SET (ISA)
-------------------------------------------
* Format: Opcode[31:24], RD[23:20], RS[19:16], RT[15:12], Imm[11:0][cite: 61, 62].
* Opcodes:
    - 0-5: ADD, SUB, AND, OR, XOR, MUL[cite: 64].
    - 6-8: SLL, SRA, SRL[cite: 64, 65].
    - 9-14: BEQ, BNE, BLT, BGT, BLE, BGE (PC = R[rd][9:0])[cite: 65].
    - 15: JAL (R[15] = PC+1, PC = R[rd][9:0])[cite: 65].
    - 16: LW (R[rd] = MEM[R[rs] + R[rt]])[cite: 65].
    - 17: SW (MEM[R[rs] + R[rt]] = R[rd])[cite: 65].
    - 20: HALT (Stop core, wait for pipeline to empty)[cite: 65].

6. OUTPUT REQUIREMENTS
-----------------------------------------
* Trace Files: Print CYCLE and PCs of FETCH, DECODE, EXEC, MEM, WB (3-hex digits) + R2-R15[cite: 85, 86, 87]. 
* Use '---' for inactive pipeline stages[cite: 88].
* Registers in trace must show values at the START of the cycle[cite: 89].
* Bus Trace: Print whenever bus_cmd != 0[cite: 89, 90].
* TSRAM Format: (MESI << 12 | Tag) in 8-hex digits[cite: 95].
* Stats: cycles, instructions, read/write hits, read/write misses, decode_stalls, mem_stalls[cite: 98].